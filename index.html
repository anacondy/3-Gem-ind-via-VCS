<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>India Governance Map 2025</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- 1. GLOBAL & LAYOUT --- */
        body, html {
            height: 100%;
            margin: 0;
            background-color: #050505;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        #map {
            height: 100vh;
            width: 100%;
            z-index: 1;
            background: #050505;
        }

        /* Mobile optimizations for better rendering */
        @media only screen and (max-width: 768px) {
            body, html {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            #map {
                height: 100vh;
                height: 100dvh; /* Dynamic viewport height for mobile browsers */
            }
        }

        /* --- 2. GLASSMORPHISM UI --- */
        .glass-header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            width: 320px;
            padding: 20px;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            color: white;
            pointer-events: none;
        }

        .glass-header h1 { margin: 0; font-size: 24px; font-weight: 800; color: #ffffff; letter-spacing: -0.5px; }
        .glass-header p { margin: 5px 0 0 0; font-size: 13px; color: #888; }
        
        /* Mobile adjustments for header */
        @media only screen and (max-width: 768px) {
            .glass-header {
                top: 10px;
                left: 10px;
                right: 10px;
                width: auto;
                padding: 15px;
            }
            .glass-header h1 { font-size: 18px; }
            .glass-header p { font-size: 11px; }
        }

        .info-sidebar {
            position: absolute;
            top: 20px;
            right: -400px;
            bottom: 20px;
            width: 320px;
            z-index: 1001;
            background: rgba(15, 15, 15, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-left: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px 0 0 20px;
            padding: 30px;
            color: white;
            transition: right 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -20px 0 50px rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        .info-sidebar.active { right: 0; }
        
        /* Mobile-specific sidebar: Half screen on mobile devices */
        @media only screen and (max-width: 768px) {
            .info-sidebar {
                top: auto;
                bottom: -60%;
                right: 0;
                left: 0;
                width: auto;
                height: 50vh;
                border-radius: 20px 20px 0 0;
                border-left: none;
                border-top: 1px solid rgba(255, 255, 255, 0.08);
                padding: 20px;
                transition: bottom 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            }
            .info-sidebar.active { 
                bottom: 0;
                right: 0;
            }
        }
        
        /* Support for 20:9 aspect ratio phones (taller screens) */
        @media only screen and (max-width: 768px) and (min-aspect-ratio: 20/9) {
            .info-sidebar {
                height: 45vh;
            }
        }
        
        /* Support for 16:9 aspect ratio phones in landscape */
        @media only screen and (max-width: 768px) and (orientation: landscape) {
            .info-sidebar {
                height: 60vh;
            }
        }

        .state-badge { display: inline-block; padding: 4px 12px; border-radius: 50px; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; }
        .badge-nda { background: rgba(255, 153, 51, 0.15); color: #FF9933; border: 1px solid rgba(255, 153, 51, 0.4); }
        .badge-india { background: rgba(0, 229, 255, 0.15); color: #00E5FF; border: 1px solid rgba(0, 229, 255, 0.4); }
        .badge-other { background: rgba(255, 255, 255, 0.1); color: #ddd; border: 1px solid rgba(255, 255, 255, 0.3); }
        .sidebar-title { font-size: 32px; font-weight: 800; margin: 0 0 20px 0; line-height: 1.1; }
        .data-section { margin-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        .data-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 8px; }
        .data-value { font-size: 16px; font-weight: 500; }
        .seat-count { font-family: 'Courier New', monospace; font-size: 18px; font-weight: 600; letter-spacing: -0.5px; }
        
        /* Mobile adjustments for sidebar content */
        @media only screen and (max-width: 768px) {
            .sidebar-title { font-size: 24px; margin: 0 0 15px 0; }
            .data-section { margin-bottom: 15px; padding-bottom: 10px; }
            .data-value { font-size: 14px; }
            .seat-count { font-size: 16px; }
        }

        /* --- 3. HOVER TOOLTIP STYLING --- */
        /* Fixed: Remove the square box when typing state/location */
        /* Note: !important is necessary to override Leaflet's default tooltip styles */
        .leaflet-tooltip.glass-tooltip {
            background: rgba(0, 0, 0, 0.85) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 8px !important;
            color: #fff !important;
            font-family: 'Inter', sans-serif !important;
            font-weight: 600 !important;
            font-size: 11px !important;
            letter-spacing: 0.5px !important;
            text-transform: uppercase !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6) !important;
            padding: 6px 12px !important;
            pointer-events: none !important;
        }

        /* Remove arrow and any default leaflet styles that cause square box */
        .leaflet-tooltip-top:before, .leaflet-tooltip-bottom:before,
        .leaflet-tooltip-left:before, .leaflet-tooltip-right:before { 
            display: none !important; 
            border: none !important;
        }
        
        /* Remove any default leaflet tooltip borders/backgrounds */
        .leaflet-tooltip {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

    </style>
</head>
<body>

    <div class="glass-header">
        <h1>India Governance Map</h1>
        <p>Political control & leadership (Nov 2025)</p>
    </div>

    <div id="sidebar" class="info-sidebar">
        <div id="sidebar-content"></div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. SETUP MAP WITH MOBILE OPTIMIZATIONS ---
        var map = L.map('map', {
            zoomControl: false,
            attributionControl: false,
            center: [22.5, 82],
            zoom: 5,
            // Mobile-specific optimizations
            tap: true,
            tapTolerance: 20,
            zoomSnap: 0.5,
            zoomDelta: 0.5,
            wheelPxPerZoomLevel: 120,
            // Better rendering on mobile
            preferCanvas: false,
            renderer: L.svg({ padding: 0.5 })
        });

        // Adjust zoom based on device
        if (window.innerWidth <= 768) {
            map.setView([22.5, 82], 4.5);
        }

        // Dark tile layer with better contrast for mobile
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            subdomains: 'abcd',
            maxZoom: 19,
            // Better performance on mobile
            updateWhenIdle: false,
            keepBuffer: 2
        }).addTo(map);

        // --- 2. DATA ---
        let politicalData = {
            "Maharashtra": { code: "N", cm: "Devendra Fadnavis", party: "BJP / Mahayuti", seats: "235 / 288", coalition: "Multi-party (BJP, Shiv Sena, NCP)", opposition: "53 seats (MVA)" },
            "Gujarat": { code: "N", cm: "Bhupendrabhai Patel", party: "BJP", seats: "156 / 182", coalition: "Single party", opposition: "26 seats (INC, AAP)" },
            "Goa": { code: "N", cm: "Pramod Sawant", party: "BJP", seats: "20 / 40", coalition: "Coalition (BJP + Independents)", opposition: "20 seats (INC, AAP, TMC)" },
            "Ladakh": { code: "N", cm: "Kavinder Gupta (LG)", party: "Central Govt", seats: "UT Admin", coalition: "Union Territory", opposition: "N/A" },
            "Jammu and Kashmir": { code: "I", cm: "Omar Abdullah", party: "JKNC", seats: "42 / 90", coalition: "Coalition (JKNC + INC)", opposition: "48 seats (BJP, PDP, Others)" },
            "Himachal Pradesh": { code: "I", cm: "Sukhvinder Singh Sukhu", party: "INC", seats: "40 / 68", coalition: "Single party", opposition: "28 seats (BJP)" },
            "Punjab": { code: "I", cm: "Bhagwant Mann", party: "AAP", seats: "92 / 117", coalition: "Single party", opposition: "25 seats (INC, BJP, SAD)" },
            "Haryana": { code: "N", cm: "Nayab Singh Saini", party: "BJP", seats: "48 / 90", coalition: "Single party", opposition: "42 seats (INC, JJP, INLD)" },
            "Uttarakhand": { code: "N", cm: "Pushkar Singh Dhami", party: "BJP", seats: "47 / 70", coalition: "Single party", opposition: "23 seats (INC)" },
            "Delhi": { code: "I", cm: "Atishi Marlena", party: "AAP", seats: "62 / 70", coalition: "Single party", opposition: "8 seats (BJP)" },
            "Uttar Pradesh": { code: "N", cm: "Yogi Adityanath", party: "BJP", seats: "255 / 403", coalition: "Coalition (BJP + Allies)", opposition: "148 seats (SP, BSP, INC)" },
            "Rajasthan": { code: "N", cm: "Bhajan Lal Sharma", party: "BJP", seats: "115 / 200", coalition: "Single party", opposition: "85 seats (INC)" },
            "Madhya Pradesh": { code: "N", cm: "Mohan Yadav", party: "BJP", seats: "163 / 230", coalition: "Single party", opposition: "67 seats (INC)" },
            "Chhattisgarh": { code: "N", cm: "Vishnu Deo Sai", party: "BJP", seats: "54 / 90", coalition: "Single party", opposition: "36 seats (INC)" },
            "Karnataka": { code: "I", cm: "Siddaramaiah", party: "INC", seats: "135 / 224", coalition: "Single party", opposition: "89 seats (BJP, JD(S))" },
            "Telangana": { code: "I", cm: "Revanth Reddy", party: "INC", seats: "64 / 119", coalition: "Single party", opposition: "55 seats (BRS, BJP)" },
            "Andhra Pradesh": { code: "N", cm: "N. Chandrababu Naidu", party: "TDP", seats: "135 / 175", coalition: "Coalition (TDP + BJP + JSP)", opposition: "40 seats (YSRCP)" },
            "Kerala": { code: "I", cm: "Pinarayi Vijayan", party: "CPI(M)", seats: "99 / 140", coalition: "Coalition (LDF)", opposition: "41 seats (UDF)" },
            "Tamil Nadu": { code: "I", cm: "M. K. Stalin", party: "DMK", seats: "133 / 234", coalition: "Coalition (DMK + INC + Allies)", opposition: "101 seats (AIADMK, BJP)" },
            "Puducherry": { code: "N", cm: "N. Rangasamy", party: "AINRC", seats: "10 / 30", coalition: "Coalition (AINRC + BJP)", opposition: "20 seats (INC, DMK)" },
            "Bihar": { code: "N", cm: "Nitish Kumar", party: "JD(U) + BJP", seats: "128 / 243", coalition: "Coalition (JD(U) + BJP)", opposition: "115 seats (RJD, INC)" },
            "Jharkhand": { code: "I", cm: "Hemant Soren", party: "JMM", seats: "47 / 81", coalition: "Coalition (JMM + INC + RJD)", opposition: "34 seats (BJP, AJSU)" },
            "West Bengal": { code: "I", cm: "Mamata Banerjee", party: "TMC", seats: "213 / 294", coalition: "Single party", opposition: "81 seats (BJP, INC, CPM)" },
            "Odisha": { code: "N", cm: "Mohan Charan Majhi", party: "BJP", seats: "78 / 147", coalition: "Single party", opposition: "69 seats (BJD, INC)" },
            "Sikkim": { code: "N", cm: "Prem Singh Tamang", party: "SKM (NDA)", seats: "31 / 32", coalition: "Single party (NDA ally)", opposition: "1 seat (SDF)" },
            "Assam": { code: "N", cm: "Himanta Biswa Sarma", party: "BJP", seats: "60 / 126", coalition: "Coalition (BJP + AGP + UPPL)", opposition: "66 seats (INC, AIUDF)" },
            "Arunachal Pradesh": { code: "N", cm: "Pema Khandu", party: "BJP", seats: "46 / 60", coalition: "Single party", opposition: "14 seats (NPP, INC, Others)" },
            "Nagaland": { code: "N", cm: "Neiphiu Rio", party: "NDPP (NDA)", seats: "37 / 60", coalition: "Coalition (NDPP + BJP)", opposition: "23 seats (NPF, Others)" },
            "Manipur": { code: "N", cm: "N. Biren Singh", party: "BJP", seats: "32 / 60", coalition: "Coalition (BJP + NPP + NPF)", opposition: "28 seats (INC, JD(U))" },
            "Mizoram": { code: "O", cm: "Lalduhoma", party: "ZPM", seats: "27 / 40", coalition: "Single party", opposition: "13 seats (MNF, INC, BJP)" },
            "Tripura": { code: "N", cm: "Manik Saha", party: "BJP", seats: "32 / 60", coalition: "Coalition (BJP + IPFT)", opposition: "28 seats (CPIM, INC, TIPRA)" },
            "Meghalaya": { code: "N", cm: "Conrad Sangma", party: "NPP (NDA)", seats: "26 / 60", coalition: "Coalition (NPP + BJP + UDP + Others)", opposition: "34 seats (INC, TMC)" }
        };

        // --- 3. GEMINI API INTEGRATION ---
        // IMPORTANT SECURITY NOTE: In production, API keys should NEVER be stored in client-side code
        // For production deployment:
        // 1. Move API key to environment variables
        // 2. Create a backend proxy endpoint to handle API calls
        // 3. Implement rate limiting and authentication
        // This implementation is for demonstration/personal use only
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE'; // Replace with actual key
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
        
        async function fetchLatestPoliticalData() {
            // Silently skip if API key is not configured
            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                console.log('Gemini API key not configured. Using default political data.');
                return;
            }
            
            console.log('Fetching latest political data from Gemini API...');
            
            const prompt = `You are a comprehensive Indian political data analyst. Provide the most current and accurate political data for ALL Indian states and union territories as of November 2025 or the latest available data (MUST be from November 2025 or later, not earlier).

For EACH state/UT, provide in JSON format:
{
  "stateName": {
    "code": "N" for NDA, "I" for INDIA bloc, "O" for Others/Regional,
    "cm": "Current Chief Minister full name",
    "party": "Full party name or coalition name",
    "seats": "Current ruling seats / Total seats",
    "coalition": "Single party" or "Coalition (Party1 + Party2)" or "Multi-party (details)",
    "opposition": "Total opposition seats and main parties"
  }
}

CRITICAL REQUIREMENTS:
1. Data MUST be from November 2025 or later
2. Cross-verify data from multiple reliable sources (Election Commission of India, official state government websites, major news agencies)
3. Include ALL 28 states and 8 union territories
4. For coalition governments, specify ALL coalition partners
5. Provide exact seat numbers (ruling party seats / total assembly seats)
6. Include opposition seat count and main opposition parties
7. Ensure accuracy of Chief Minister names and current party affiliations
8. Double-check recent election results and government formations
9. Verify any recent defections, alliance changes, or government changes
10. If any state had elections in 2024-2025, ensure data reflects the current government

States to cover: Maharashtra, Gujarat, Goa, Karnataka, Kerala, Tamil Nadu, Andhra Pradesh, Telangana, Odisha, West Bengal, Bihar, Jharkhand, Uttar Pradesh, Madhya Pradesh, Rajasthan, Chhattisgarh, Punjab, Haryana, Himachal Pradesh, Uttarakhand, Assam, Sikkim, Arunachal Pradesh, Nagaland, Manipur, Meghalaya, Tripura, Mizoram

Union Territories: Delhi, Jammu & Kashmir, Puducherry, Ladakh, Chandigarh, Dadra & Nagar Haveli and Daman & Diu, Lakshadweep, Andaman & Nicobar Islands

Provide ONLY valid JSON in your response, no additional text or explanations.`;

            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            topK: 1,
                            topP: 0.95,
                            maxOutputTokens: 8192,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                // Validate API response structure
                if (!data || !data.candidates || !Array.isArray(data.candidates) || data.candidates.length === 0) {
                    throw new Error('Invalid API response structure');
                }
                
                if (!data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
                    throw new Error('Missing content in API response');
                }
                
                const apiResponse = data.candidates[0].content.parts[0].text;
                
                if (!apiResponse || typeof apiResponse !== 'string') {
                    throw new Error('Invalid response text');
                }
                
                // Extract JSON from response (handle markdown code blocks)
                let jsonText = apiResponse;
                if (apiResponse.includes('```json')) {
                    jsonText = apiResponse.split('```json')[1].split('```')[0].trim();
                } else if (apiResponse.includes('```')) {
                    jsonText = apiResponse.split('```')[1].split('```')[0].trim();
                }
                
                const newPoliticalData = JSON.parse(jsonText);
                
                // Validate and merge data
                if (Object.keys(newPoliticalData).length > 0) {
                    // Merge with existing data (keep structure)
                    politicalData = { ...politicalData, ...newPoliticalData };
                    
                    // Refresh the map
                    if (window.geojson) {
                        map.removeLayer(window.geojson);
                        loadGeoJSON();
                    }
                    
                    console.log('Political data updated successfully from Gemini API');
                } else {
                    throw new Error('No valid data received');
                }
                
            } catch (error) {
                console.error('Error fetching data from Gemini API:', error);
            }
        }
        
        // --- 4. STYLING ---
        function getColor(stateName) {
            if(stateName === "Orissa") stateName = "Odisha";
            if(stateName === "Uttaranchal") stateName = "Uttarakhand";
            const data = politicalData[stateName];
            if (!data) return '#333';
            if (data.code === 'N') return '#FF9933';
            if (data.code === 'I') return '#00E5FF';
            if (data.code === 'O') return '#FFFF00';
            return '#333';
        }

        function style(feature) {
            let name = feature.properties.NAME_1 || feature.properties.st_nm;
            if(name === "Orissa") name = "Odisha";
            if(name === "Uttaranchal") name = "Uttarakhand";
            if(name === "NCT of Delhi") name = "Delhi";
            if(name === "Jammu & Kashmir") name = "Jammu and Kashmir";
            if(name === "Arunachal Pradesh") name = "Arunachal Pradesh";

            const color = getColor(name);
            
            return {
                fillColor: color,
                weight: 1.5,
                opacity: 0.8,
                color: color,
                fillOpacity: 0.2,
                // Mobile optimizations
                className: 'state-polygon'
            };
        }

        // --- 5. INTERACTION ---
        function highlightFeature(e) {
            var layer = e.target;
            layer.setStyle({ weight: 3, color: '#fff', fillOpacity: 0.5 });
            layer.bringToFront();
        }

        function resetHighlight(e) {
            geojson.resetStyle(e.target);
        }

        function zoomToFeature(e) {
            var layer = e.target;
            let name = layer.feature.properties.NAME_1 || layer.feature.feature.properties.st_nm;

            if(name === "Orissa") name = "Odisha";
            if(name === "Uttaranchal") name = "Uttarakhand";
            if(name === "NCT of Delhi") name = "Delhi";
            if(name === "Jammu & Kashmir") name = "Jammu and Kashmir";

            map.flyToBounds(layer.getBounds(), { padding: [50, 50], duration: 1.2 });
            updateSidebar(name);
            document.getElementById('sidebar').classList.add('active');
        }

        function onEachFeature(feature, layer) {
            let name = feature.properties.NAME_1 || feature.properties.st_nm;
            if(name === "Orissa") name = "Odisha";
            if(name === "Uttaranchal") name = "Uttarakhand";
            if(name === "NCT of Delhi") name = "Delhi";
            if(name === "Jammu & Kashmir") name = "J&K";
            if(name === "Andaman and Nicobar Islands") name = "Andaman";

            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });

            // **CLEAN MODE LOGIC**
            // permanent: false = Shows ONLY when mouse is over the state
            // No clutter. No messy text overlap.
            if (name) {
                layer.bindTooltip(name, {
                    permanent: false,
                    direction: "center",
                    className: "glass-tooltip"
                });
            }
        }

        function updateSidebar(stateName) {
            const data = politicalData[stateName];
            if (!data) {
                document.getElementById('sidebar-content').innerHTML = `<h2 class="sidebar-title">${stateName}</h2><p style="color:#888">Data not available.</p>`;
                return;
            }
            let badgeClass = data.code === 'N' ? 'badge-nda' : data.code === 'I' ? 'badge-india' : 'badge-other';
            let allianceName = data.code === 'N' ? 'NDA (Ruling)' : data.code === 'I' ? 'INDIA Bloc' : 'Regional / Ind.';

            const html = `
                <span class="state-badge ${badgeClass}">${allianceName}</span>
                <h2 class="sidebar-title">${stateName}</h2>
                <div class="data-section"><div class="data-label">Chief Minister</div><div class="data-value">${data.cm}</div></div>
                <div class="data-section"><div class="data-label">Ruling Party</div><div class="data-value">${data.party}</div></div>
                <div class="data-section"><div class="data-label">Assembly Strength</div><div class="seat-count">${data.seats}</div></div>
                ${data.coalition ? `<div class="data-section"><div class="data-label">Coalition Type</div><div class="data-value">${data.coalition}</div></div>` : ''}
                ${data.opposition ? `<div class="data-section"><div class="data-label">Opposition</div><div class="data-value">${data.opposition}</div></div>` : ''}
            `;
            document.getElementById('sidebar-content').innerHTML = html;
        }

        map.on('click', function(e) {
             if (e.originalEvent.target.id === 'map') {
                 document.getElementById('sidebar').classList.remove('active');
                 // Adjust zoom based on device
                 const zoomLevel = window.innerWidth <= 768 ? 4.5 : 5;
                 map.flyTo([22.5, 82], zoomLevel);
             }
        });

        // Load GeoJSON data
        function loadGeoJSON() {
            fetch('https://raw.githubusercontent.com/geohacker/india/master/state/india_telengana.geojson')
                .then(res => res.json())
                .then(data => {
                    window.geojson = L.geoJson(data, {
                        style: style,
                        onEachFeature: onEachFeature
                    }).addTo(map);
                })
                .catch(error => {
                    console.error('Error loading GeoJSON:', error);
                });
        }
        
        // Initial load
        loadGeoJSON();
        
        // Automatically fetch latest political data if API key is configured
        // This runs silently in the background after page load
        fetchLatestPoliticalData();

    </script>
</body>
</html>